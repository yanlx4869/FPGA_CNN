<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据上传</title>
    <link rel="stylesheet" type="text/css" href="">
    <link rel="stylesheet" href="css/count.css" type="text/css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/personal.css">
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <style type="text/css">
      #area{width:40%;height: 150px; line-height: 150px; text-align: center; border: 1px solid #DDDDDD; position:absolute; top: 0px;left:450px; }
      #prev{width:500;min-height: 150px;   position: absolute; top:250px;left:450px; }
      #prev{
        position: relative;
        top:-855px;
        left:0px;
      }
      .xiazai{
        background-color: #4caf50;
        border:none;
        color: #fff;
        padding: 15px;
        text-align: center;
        font-size: 18px;
        border-radius: 8px;
        width:150px;
        position:absolute;
        top:1340px;
        left: 1075px;
      }
  </style>
  <style>
      h1.chuan1{
           position: absolute;
           top:100px;
           left: 350px;
           float: left;
           width: 416px;
           height:28px;
           color: darkgreen;
           font-size: 20px;
           letter-spacing:5px;
        }
        </style>

          
</head>

<body>
  <div class="menu-bar">
    <h1 class="logo">counter树冠识别系统</h1>
    <ul>
        <li><a href="#">首页</a></li>
        <li><a href="#">登录</a></li>
        <li><a href="#">数据上传</a></li>
        <li><a href="#">个人中心</a></li>
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control search" placeholder="搜索">
          </div>
          <button type="submit" class="btn btn-default search">确认</button>
        </form>
    </ul>
</div>
 

    <div class="main">
      <div class="beijing"></div>
        <div class="dianji">
            <input type="file" id="upload" multiple style="font-size:medium; " />
           <div class="tupian">
            <script>
              // 文件规则
              const ACCEPT = ['image/jpg', 'image/png', 'image/jpeg'];
              const MAXSIZE = 6 * 1024 * 1024;
              const MAXSIZE_STR = '1MB';
        
              const upload = document.querySelector('#upload');
              // 监听文件上传事件并传值
              upload.addEventListener('change', (e) => {
                console.log(e.target.files);
                const [file] = e.target.files;
                if (!file) {
                  return;
                }
                const { type: fileType, size: fileSize } = file;
                // 图片类型检查
                if (!ACCEPT.includes(fileType)) {
                  alert(`暂时不支持${fileType}文件类型`);
                  upload.value = '';
                  return;
                }
                // 图片大小检查
                if (fileSize > MAXSIZE) {
                  alert(`该文件超出${MAXSIZE_STR}`);
                  upload.value = '';
                  return;
                }
                converImageToBase64(file, (base64Image) =>
                  compress(base64Image, uploadToServer)
                );
              });
        
              // 原图转为base64
              function converImageToBase64(file, callback) {
                let reader = new FileReader();
                reader.readAsDataURL(file);
                reader.addEventListener('load', function (e) {
                  const base64Image = e.target.result;
                  // console.log('原图base64', base64Image);
                  // 将nase64文件传入压缩方法中
                  callback && callback(base64Image);
                });
              }
              // 图片压缩主要代码
              function compress(base64Image, callback) {
                let maxW = 600;
                let maxH = 600;
                const image = new Image();
                image.src = base64Image;
                // document.body.appendChild(image); 
        
                // 监听图片加载事件
                image.addEventListener('load', function (e) {
                  let ratio; // 图片压缩比
                  let needCompress = false; // 图片是否需要压缩
                  if (maxW < image.naturalWidth) {
                    needCompress = true;
                    ratio = image.naturalWidth / maxW;
                    maxH = image.naturalHeight / ratio;
                  }
                  if (!needCompress) {
                    ratio = image.naturalHeight / maxH;
                    maxW = image.naturalHeight / ratio;
                  }
                  const canvas = document.createElement('canvas');
                  canvas.setAttribute('id', '__compress__');
                  canvas.width = maxW;
                  canvas.height = maxH;
                  canvas.style.visibility = 'hidden';
                  document.body.appendChild(canvas);
        
                  const ctx = canvas.getContext('2d');
                  ctx.clearRect(0, 0, maxW, maxH);
                  ctx.drawImage(image, 0, 0, maxW, maxH);
                  const compressImage = canvas.toDataURL('image/jpeg', 0.8); // 值越大压缩后的图片越小，但是太小图片会失真
                  callback && callback(compressImage);
                  // 显示压缩后的图片
                  const _image = new Image();
                  _image.src = compressImage;
                  document.body.appendChild(_image); // 预览压缩后的图片
                  canvas.remove();
                  // console.log('压缩比', image.src.length / _image.src.length);
                });
              }
              // 压缩后的base64上传到服务器
              function uploadToServer(compressImage) {
                console.log('uploadToServer......', compressImage);
                if (compressImage) {
                  alert('图片上传成功');
                }
              }
            </script>
            </div>
        </div>





        <div class="tishi">
        <h1 class="chuan1">请在下方区域上传图片</h1>
        <div class="shuoming">您可以选择点击按钮或者拖拽上传两种方式，我们会识别您上传的图像，并在下方显示数据报告</div>
        <div class="tuo">
        <div id="area">将图片拖放到该区域</div>
        <canvas id="myCanvas" width=500px: height=600px; ></canvas>
        <body>
    
            <div id="prev"></div>
        </body>
    
      <script>
        window.onload = function(){
            var oArea = document.getElementById("area");
            var oPrev = document.getElementById("prev");
    
            oArea.ondragenter = function(){
                oArea.innerHTML = "请释放鼠标";
            }
            oArea.ondragleave = function(){
                oArea.innerHTML = "将图片拖放到该区域";
            }
            oArea.ondragover = function(ev){
                ev.preventDefault();
            }
            oArea.ondrop = function(ev){
                ev.preventDefault();
                var files = ev.dataTransfer.files;
                for(var i = 0 , len = files.length;i<len;i++){
                    var file = files[i];
                    var reader = new FileReader();
                    reader.readAsDataURL(file);
                    (function(reader){
                        reader.onload = function(){
                            var oImg = document.createElement("img");
                            oImg.src = this.result;
                            oPrev.appendChild(oImg);
                        }
                    })(reader);
    
                }
    
            }
    
        }
      </script>
    </div>   
    </div>  
    </div>


    <div class="baogao">
      <h2 class="chuan2">此图片的数据报告为</h2>
      <div class="shuoming1">经过我们的识别，为您提供上传结果的具体信息，包括八个树种的树冠数量及图片</div>
      <div class="container">
      <table  class="table table-striped table-bordered table-hover">
        <tr align="center" class="info">
          <tr align="center" class="info">
            <table border="1px" border-color="#f9f9f9" width="900px" height="500px">
            <td colspan="2" align="center" id="biaotou">树冠图片识别报告</td>
        </tr>
        <tr align="center" id="biao11">
            <td>树种</td>
            <td>数量</td>
            
        </tr>
        <tr align="center" id="biao1">
            <td>0001</td>
            <td>如花</td>
            
        </tr>
        <tr align="center" id="biao5">
            <td>0002</td>
            <td>张三</td>
            
        </tr>
        <tr align="center" id="biao2">
            <td>0003</td>
            <td>李四</td>
        </tr>
        <tr align="center" id="biao6">
          <td>0005</td>
          <td>数量</td>
          
      </tr>
      <tr align="center" id="biao3">
          <td>0006</td>
          <td>如花</td>
          
      </tr>
      <tr align="center" id="biao7">
          <td>0007</td>
          <td>张三</td>
          
      </tr>
      <tr align="center" id="biao4">
          <td>0008</td>
          <td>李四</td>
      </tr>
      <tr align="center" id="biao8">
        <td>0009</td>
        <td>李四</td>
    </tr>

    </table>
  </table>
    </div>
  </div>
  <h3>此处或许还有个图片</h3>
 <input name="xiazia" type="button"  value="下载报告" class="xiazai">
  

    <div class="copyright">
        <p>Copyright &copy; counter树冠识别系统 byCNNT
        </p>
    </div>
</body>

</html>